<div class="flex flex-row h-full">
  <div class="flex-2">
    <google-map
      [options]="mapOptions()"
      [width]="'100%'"
      [height]="'100%'"
      (mapClick)="canOpenDialog() && (isDialogOpen = true)"
      class="cursor-pointer relative"
    >
      @for (existingMarker of atlasMarkers(); track $index) {
      <map-advanced-marker
        #thisMarker="mapAdvancedMarker"
        [options]="existingMarker"
        (mapClick)="thisInfoWindow.open(thisMarker)"
      ></map-advanced-marker>
      <map-info-window
        [options]="infoWindowOptions"
        #thisInfoWindow="mapInfoWindow"
      >
        <div class="flex flex-col items-center">
          <p class="text-lg m-2 font-bold">
            {{ existingMarker.title }}
          </p>
          <div class="flex flex-row">
            <button
              (click)="thisInfoWindow.close()"
              class="bg-gray-400 text-white hover:bg-gray-500 focus:outline-none shadow-md cursor-pointer text-xs flex flex-row items-center content-center justify-center mx-2 p-2"
            >
              Close
            </button>
            <button
              class="bg-sky-600 text-white hover:bg-sky-700 focus:outline-none shadow-md cursor-pointer text-xs flex flex-row items-center content-center justify-center mx-2 p-2"
            >
              Go to marker
            </button>
          </div>
        </div>
      </map-info-window>
      }
    </google-map>
    <app-dialog
      [dialogConfig]="dialogConfig"
      [open]="isDialogOpen"
      (dialogClosed)="userCompletesAddDialog($event)"
    >
      <input
        type="text"
        name=""
        id=""
        placeholder="name of marker"
        [formControl]="newMarkerNameFormControl"
      />
    </app-dialog>
  </div>
  <div class="flex-1 bg-zinc-100 flex flex-col justify-around p-4">
    <h1 class="text-3xl text-center">{{ map?.title || "Untitled map 🤦‍♂️" }}</h1>

    <div class="overflow-y-auto max-h-6/10">
      @for (item of markers(); track $index) {
      <app-card
        class="m-2"
        (click)="onCardClick($index)"
        [cardConfig]="{
          title: item.title,
          subtitle: item.createdAt
        }"
      ></app-card>
      } @empty {
      <h1>No markers yet 🤷‍♂️</h1>
      }
    </div>
    <div class="flex flex-row justify-center mt-7">
      <app-button
        [config]="goBackButtonConfig"
        (btnClick)="router.navigate(['markers', mapId])"
      ></app-button>

      @if (mapMode() === 'add') {
      <app-button
        [config]="moveButtonConfig"
        (btnClick)="mapMode.set('move')"
      ></app-button>

      }@else {
      <app-button
        [config]="addButtonConfig"
        (btnClick)="mapMode.set('add')"
      ></app-button>

      }
    </div>
  </div>
</div>
